:labname: Vulnerability Management

== {labname}

:numbered:

== Introduction to vulnerability management in RHACS

You start with the topic of vulnerability management because it is familiar to most security teams, even those without prior experience with containers or Kubernetes.

The vulnerability management process helps protect the software supply chain and prevent known vulnerabilities from being used as an entry point into your applications.

In this lab, you explore the vulnerability management features of Red Hat^(R)^ Advanced Cluster Security.

The overview provides several important reports - where the vulnerabilities are, which are the most widespread or the most recent, where my container images are coming from, and important vulnerabilities in OpenShift itself.

More important than fixing any one vulnerability is establishing a process to keep container images updated and to prevent the promotion through the pipeline for images that have serious, fixable vulnerabilities.

.Goals

* Understand reports in the Vulnerability Management Dashboard
* Set and manage risk acceptance workflows 
* Create a simple report to email to stakeholders

:numbered:

[[vuln-mgmt]]

=== The Vulnerability Management (1.0) dashboard

Let us continue by looking at our primary use case for RHACS that is the Vulnerability Management features and dashboard, a familiar topic for most security teams.

IMPORTANT: The locations and size of your panels may vary depending on your screen size and zoom.

NOTE: For the following section, please note that the order in which the images appear or the number of components affected may vary depending on versions and other applications running in the cluster.

. Click the *Vulnerability Management (1.0)* tab, and then select *Dashboard*

image::acs-vuln-dashboard-00.png[link=self, window=blank, width=100%, Vulnerability Management Dashboard]

The dashboard provides several critical vulnerability breakdowns, such as:

- Top risky deployments/images
- Recently detected image vulnerabilities
- Most common image vulnerabilities

More important than fixing any vulnerability is establishing a process to keep container images updated and to prevent the promotion through the pipeline for images with serious, fixable vulnerabilities. RHACS displays this through the *Top Risky Deployments by CVE and CVSS Score* and takes the container’s configuration and vulnerability details to show you the most *at risk* deployments in your cluster.

image::acs-vuln-dashboard-01.png[link=self, window=blank, width=100%, Riskiest Deployments]

[start=2]

. Above the panel information, there are buttons to link you to all policies, CVEs, and images, and a menu to bring you to reports by cluster, namespace, deployment, and component. The vulnerability dashboard can be filtered by clicking the *Fixable CVSS score* button.

image::acs-vuln-dashboard-02.png[link=self, window=blank, width=100%, Top Policy Buttons]

[start=3]

. Locate the *Top riskiest images* panel. 

Here, you can see the CVEs associated with containers currently running in the cluster. The goal is to find the *log4shell* exploit in your cluster and block that container from being pushed in the future.

image::acs-risk-02.png[link=self, window=blank, width=100%, Riskiest Images]

[start=4]

. In the *Top Riskiest Images* panel, click on the *VIEW ALL* button.

image::acs-risk-03.png[link=self, window=blank, width=100%, Riskiest Images]

The images in this dashboard are listed here in order of *risk*, 

Risk is based on a multitude of security issues, such as

- the severity of the vulnerabilities present
- in the components in the images
- vulnerability impact
- the image is active

image::acs-risk-04.png[link=self, window=blank, width=100%, Riskiest Images]

Notice which images are more exposed. Not only can we see the number of CVEs affecting the images, but which of them are fixable? We can also see:

- Creation date
- Scan time
- Image OS
- Image status
- How many deployments are using the vulnerable image
- The total components in the image

[start=5]

. Next, find and click on the image *ctf-web-to-system:latest-v2*. You will review the images' components and violations.

image::acs-risk-05.png[link=self, window=blank, width=100%, Visa Processor Image]

NOTE: If you cannot find the ctf-web-to-system:latest-v2 image, use the search bar to filter for the specific image you want. Try searching by *deployment* And then entering *ctf-web-to-system*

image::acs-risk-06.png[link=self, window=blank, width=100%, Search Bar]

You can move on to the next section only when the dashboard displays the image below.

image::acs-risk-07.png[link=self, window=blank, width=100%, Image Info]

=== RHACS Vulnerability Scanner

RHACS' Scanner v4 is a built-in vulnerability scanner that breaks down images into layers and components - where components can be operating-system installed packages or dependencies installed by programming languages like Python, Javascript, Go, Java and more. The *Image Summary tab* provides the essential security details of the image overall, with links to the components. Below, you can see why the image is ranked as a critically vulnerable application:

- In the *Details and metadata* → Image Summary panel, the information you see there tells you that this image has a severe security problem - the base image was imported several years ago (Debian 8 - 2015).
- At the top of the page is the warning that CVE data is stale - that this image has a base OS version whose distribution has stopped providing security information and likely stopped publishing security fixes. ACS will still scan for language issues even if the Operating System does not have CVE dat available.


.Procedure
. Scroll down the page to the *Image Findings* section.

Here you find the details of the image vulnerabilities. There are 82 vulnerabilities detected with 80 of those vulnerabilities listed as fixable (at the time of the creation of this workshop.)

image::acs-vulns-00.png[link=self, window=blank, width=100%, Fixable Vulnerabilities]

[start=2]

. Above the Image Findings section, click on the *Dockerfile* tab:

image::acs-vulns-01.png[link=self, window=blank, width=100%, Dockerfile View]

The Dockerfile tab view shows the layer-by-layer view, and, as you can see, the most recent layers are also several years old. Time is not kind to images and components - as vulnerabilities are discovered, RHACS will display newly discovered CVEs. The layers that are listed as *Source=OS* are not showing CVE data since the CVE feeds are stale or do not have an information. However, the Python libraries that are added to the container are showing vulnerabilities. For example the 'mercurial' package in the 4 layer.

image::acs-vulns-02.png[link=self, window=blank, width=100%]

=== The Vulnerability Management (2.0) dashboard

The Vulnerability Management 2.0 dashboard is part of a more extensive overhaul of vulnerability management in RHACS. Vulnerability management 2.0 is focused on the categorizing vulnerabilities by workload so that we can scan RHEL CoreOS and node-level scanning and correlate it with platform and application vulnerabilities. This is because security teams want to understand at what software layer of vulnerability resides so they know what team it can reach out to to resolve a fix. 

Let's start off this section by reviewing a similar use case in the Vulnerability Management 2.0 dashboard.

image::02-vuln2-1.png[link=self, window=blank, width=100%]

Another dashboard aims to show the same information as the vulnerability management 1.0 dashboard, but in a more scalable and systematic approach, you can see on the top left that the vulnerabilities are categorized by CVE, Image and Deployment.

In the UI, you will see thousands of vulnerabilities, over 200 images and over 300 deployments. This is because multiple images are being used across different deployments

NOTE: The numbers may be different in your environments. 

image::02-vuln2-2.png[link=self, window=blank, width=100%]

Let's find our vulnerable Java application and do some dissecting

.Procedure

. Click the drop down and select deployment

image::02-vuln2-3.png[link=self, window=blank, width=100%]

. Then filt for the *ctf-web-to-system* image

image::02-vuln2-4.png[link=self, window=blank, width=100%]

You will get the same information from the previous section. However, if you click the deployments tab, you will see the specific deployments with all these vulnerabilities this ability to see the individual deployments as well as their images is crucial when you're talking about multiple clusters and thousands of vulnerabilities you're going to have the same workloads across different clusters and you will need to drill down into the individual deployments


